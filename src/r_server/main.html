<!DOCTYPE html>
<html>
<head>
	<title>Groovy Robot</title>
	<style>
		img {
			max-width: 100%;
			height: auto;
		}
		body {
		  background: url(/images/wall-e.jpg) no-repeat;
		  background-size: 100%;
		}

        #main {
            width: {{ resolution[0] }}px;
            height: {{ resolution[1] }}px;
            background-color: red;

            position: absolute;
            top:0;
            bottom: 0;
            left: 0;
            right: 0;

            margin: auto;
        }
	</style>
	<script type="text/javascript">
        'use strict'

        var ws = new WebSocket('ws://{{ host }}/ws');
        ws.onopen = function () {
            ws.send('hello');
        };
        ws.onmessage = function (evt) {
            console.log(evt.data);
        };

		var sendKey = (keyName) => {
			if (keyName === 'w' || keyName === 'ArrowUp') {
                ws.send('w');
            }
            else if (keyName === 's' || keyName === 'ArrowDown') {
                ws.send('s');
            }
            else if (keyName === 'a' || keyName === 'ArrowLeft') {
                ws.send('a');
            }
            else if (keyName === 'd' || keyName === 'ArrowRight') {
                ws.send('d');
            } else {
                ws.send(keyName)
            }
		};

		var keydownHandler = (event) => {
            // Ignore repeated events FFS
            if (event.repeat) {
                return
            }

            const keyName = event.key.toLowerCase();

            console.log('down: ' + keyName)

			sendKey(keyName)
        };

		var keyupHandler = (event) => {
            const keyName = event.key.toUpperCase();

            console.log('up: ' + keyName)

            sendKey(keyName)

        };

        document.addEventListener('keydown', keydownHandler, false);
        document.addEventListener('keyup', keyupHandler, false);
	</script>
</head>
<body>
    <div id="main">
        <center>
           <img src="{{ url_for('stream') }}"/>
        </center>
    </div>
</body>
</html>
